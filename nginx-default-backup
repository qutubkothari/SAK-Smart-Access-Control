server {
 server_name sac.saksolution.com 3.108.52.219 _;

 root /var/www/html;
 index index.html;

 location / {
 try_files \$uri \$uri/ /index.html;
 }

 location /api/ {
 proxy_pass http://localhost:3000/api/;
 proxy_http_version 1.1;
 proxy_set_header Upgrade \$http_upgrade;
 proxy_set_header Connection "upgrade";
 proxy_set_header Host \$host;
 proxy_cache_bypass \$http_upgrade;
 proxy_set_header X-Real-IP \$remote_addr;
 proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
 proxy_set_header X-Forwarded-Proto \$scheme;
 }

 location /sak/inbound/ {
 proxy_pass http://127.0.0.1:3005;
 proxy_http_version 1.1;
 proxy_set_header Host \$host;
 proxy_set_header X-Real-IP \$remote_addr;
 proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
 proxy_set_header X-Forwarded-Proto \$scheme;
 }

 location /socket.io/ {
 proxy_pass http://localhost:3000/socket.io/;
 proxy_http_version 1.1;
 proxy_set_header Upgrade \$http_upgrade;
 proxy_set_header Connection "upgrade";
 proxy_set_header Host \$host;
 proxy_cache_bypass \$http_upgrade;
 }

 location /health {
 access_log off;
 add_header Content-Type text/plain;
 return 200 "healthy\n";
 }

 gzip on;
 gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
 gzip_min_length 1000;

 listen [::]:443 ssl ipv6only=on;
 listen 443 ssl;
 ssl_certificate /etc/letsencrypt/live/sac.saksolution.com/fullchain.pem;
 ssl_certificate_key /etc/letsencrypt/live/sac.saksolution.com/privkey.pem;
 include /etc/letsencrypt/options-ssl-nginx.conf;
 ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}

server {
 if (\$host = sac.saksolution.com) {
 return 301 https://\$host\$request_uri;
 }

 listen 80 default_server;
 listen [::]:80 default_server;
 server_name sac.saksolution.com 3.108.52.219 _;
 return 404;
}
